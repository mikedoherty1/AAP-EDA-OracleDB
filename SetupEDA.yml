---
- hosts: all
  vars:
    ansible_python_interpreter: auto_silent
  tasks:
# Touch File
    - name: Check that the file exists
      stat:
        path: /root/software/AAP-bundle-2.4-6.2-x86_64.tar.gz
      register: stat_result
    - name: Copy EDA From "{{ aap_serv }}" to "{{ inventory_hostname }}" 
      ansible.builtin.synchronize:
        src: /root/software/AAP-bundle-2.4-6.2-x86_64.tar.gz
        dest: /root/software/AAP-bundle-2.4-6.2-x86_64.tar.gz
      when: stat_result.stat.exists == False 
      delegate_to: "{{ aap_serv }}"
    - name: create software directory 
      ansible.builtin.shell:
        cmd: mkdir -p /root/software/aap-bundle-2.4-6.2
      register: shell
    - debug: var=shell.stdout_lines
    - name: move Binaries
      ansible.builtin.shell:
        cmd: mv /root/software/AAP-bundle-2.4-6.2-x86_64.tar.gz /root/software/aap-bundle-2.4-6.2
      register: shell
    - debug: var=shell.stdout_lines
    - name: Untar Binaries
      ansible.builtin.shell:
        cmd: tar -xzvf AAP-bundle-2.4-6.2-x86_64.tar.gz
        chdir: /root/software/aap-bundle-2.4-6.2
      register: shell
    - debug: var=shell.stdout_lines
    - name: backup EDA Inventoy file  
      ansible.builtin.shell:
        cmd: cp inventory orig-inventory
        chdir: /root/software/aap-bundle-2.4-6.2
      register: shell
    - debug: var=shell.stdout_lines
    - name: Update Inventoy file with AAP server 
      ansible.builtin.shell:
        cmd: sed -i "s/change_host_name/"{{ aap_srv }}"/g" /root/software/aap-bundle-2.4-6.2/inventory
        chdir: /root/software/aap-bundle-2.4-6.2
      register: shell
    - debug: var=shell.stdout_lines
    - name: Add ssh fingerprint to known_hosts file on "{{ inventory_hostname }}"  server for server "{{ aap_serv }}"
      ansible.builtin.shell:
        cmd: ssh-keyscan -H "{{ aap_serv }}" >> ~/.ssh/known_hosts
      register: shell
    - debug: var=shell.stdout_lines  

